/*! Puppetglasses - v0.1.0 - 2015-03-15
* https://github.com/tosmi/puppetglasses
* Copyright (c) 2015 Toni Schmidbauer; Licensed GPLv3 */
window.puppetglassesConfig={},puppetglassesConfig.puppetdb_url="http://localhost:2080/v3";var PuppetglassesStatistics=function(){function a(){this.total_nodes=0,this.active_nodes=0,this.stale_nodes=0,this.num_resources=0,this.collect=function(){var a=puppetglassesConfig.puppetdb_url+"/nodes",b=this;$.get(a).done(function(a){b.calculateStatistics(a)}),a=puppetglassesConfig.puppetdb_url+"/metrics/mbean/"+encodeURIComponent("com.puppetlabs.puppetdb.query.population:type=default,name=num-resources"),$.get(a).done(function(a){b.numResources(a)})},this.numResources=function(a){this.num_resources=a.Value,this.displayStatistics()},this.calculateStatistics=function(a){this.total_nodes=a.length,this.displayStatistics()},this.displayStatistics=function(){$("#total_nodes").text(this.total_nodes),$("#num_resources").text(this.num_resources)}}return a.prototype.run=function(){this.collect()},a}(),Puppetglasses=function(){"use strict";function a(){this.config=puppetglassesConfig,this.statistics=new PuppetglassesStatistics}function b(a,b){for(var c=[],d=0;d<a.length;d++)c.push(a[d].name);b(c)}function c(a){e.row.add([a.type,a.title,d(a.parameters)])}function d(a){var b="";for(var c in a)a.hasOwnProperty(c)&&(b+=c+"=>"+a[c]+"\n");return b}a.prototype.findNodes=function(a,c){var d=this.config.puppetdb_url+'/nodes?query=["~","name","'+a.term+'"]';$.getJSON(d).done(function(a){b(a,c)})},a.prototype.findResources=function(){var a=$("#hostname").val(),b=this.config.puppetdb_url+"/nodes/"+a+"/resources",c=this;$.get(b).done(function(a){c.displayResources(a)})},a.prototype.displayResources=function(a){e.clear(),a.map(c),e.search("").columns().search("").draw(),this.addTooltips(),$("#resources").show()},a.prototype.addTooltips=function(){e.column(2).visible(!0),$("#resource_table tbody tr").each(function(){var a=$("td",this)[2],b=$(a).text();this.setAttribute("title",b)}),e.column(2).visible(!1)},a.prototype.showStatistics=function(){var a=this;$("#navbar_statistics").toggleClass("active"),$("#navbar_resources").toggleClass("active"),$("#puppetglasses_resources").hide(),$("#puppetglasses_statistics").show(0,function(){a.statistics.run()})},a.prototype.showResources=function(){$("#navbar_statistics").toggleClass("active"),$("#navbar_resources").toggleClass("active"),$("#puppetglasses_resources").show(),$("#puppetglasses_statistics").hide()};var e=$("#resource_table").DataTable({search:{caseInsensitive:!1},columnDefs:[{targets:2,searchable:!1}]});return a}();$(document).ready(function(){var a=new Puppetglasses;$("#hostname").autocomplete({source:function(b,c){a.findNodes(b,c)}}),$("#search").click(function(){a.findResources()}),$("#navbar_statistics").click(function(){a.showStatistics()}),$("#navbar_resources").click(function(){a.showResources()}),$("#resources").hide(),$("#puppetglasses_statistics").hide(),$("#resource_table").on("draw.dt",function(){a.addTooltips()})});